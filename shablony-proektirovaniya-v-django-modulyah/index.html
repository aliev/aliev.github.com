<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../static/style.css">
    <link rel="stylesheet" href="../static/font-awesome.min.css">
    <link rel="stylesheet" href="../static/admonition-text.css">
    <link rel="stylesheet" href="../static/pygments.css">
    <title>Шаблоны проектирования в Django модулях</title>
</head>
<body>
    <main>
        
        
        
        
        
        
        
        
        
  
  <div class="blog-post">
  
    <h2>Шаблоны проектирования в Django модулях</h2>
  
  <p class="meta">
    written by
    
      
    
    on 
  </p>
  <p>Совсем недавно я разбирал исходники модуля Django-Allauth. Allauth является одним из тех модулей, читая исходники которого можно много чему научиться.</p>
<p>Настройки на уровне приложения</p>
<p>Если посмотреть исходники в глаза сразу бросается файл app_settings.py</p>
<p><a href="https://github.com/pennersr/django-allauth/blob/master/allauth/app_settings.py">https://github.com/pennersr/django-allauth/blob/master/allauth/app_settings.py</a></p>
<p><a href="https://github.com/pennersr/django-allauth/blob/master/allauth/account/app_settings.py">https://github.com/pennersr/django-allauth/blob/master/allauth/account/app_settings.py</a></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AppSettings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="nf">_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dflt</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">dflt</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">NUMBER_PER_USER</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Invitations number per user &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setting</span><span class="p">(</span><span class="s1">&#39;NUMBER_PER_USER&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">FROM_EMAIL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Invitations from email &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setting</span><span class="p">(</span><span class="s1">&#39;FROM_EMAIL&#39;</span><span class="p">,</span> <span class="s1">&#39;noreply@infty.xyz&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SUBJECT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Subject for email invitation &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setting</span><span class="p">(</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">,</span> <span class="s1">&#39;Invitation&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">INVITATION_ONLY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Signup is invite only &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setting</span><span class="p">(</span><span class="s1">&#39;INVITATION_ONLY&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


<span class="n">app_settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">(</span><span class="s1">&#39;INVITATIONS_&#39;</span><span class="p">)</span>
</pre></div>
<p>Это очень удобно, когда хочется разделить логику настроек уровня приложения и базового проекта. В данном примере, в app_settings.py так же указаны значения по умолчанию. Чтобы их переопределить достаточно в базовом файле settings.py указать эти параметры.</p>
<p>Шаблон проектирования registry</p>

  </div>

  <div class="comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() { this.page.identifier = "/shablony-proektirovaniya-v-django-modulyah"; };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//alialiev.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"
    rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div>

    </main>
    <a href="https://github.com/aliev"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>
</body>
</html>
